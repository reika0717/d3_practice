<!DOCTYPE html>
<html lang="jp">
<head>
<style>
html, body {
    width: 100%;
    height: 100%;
}
   
svg {
    width:900px;
    height: 900px;
    background-color:#ccc;
}

#btn {
    display: block;
}

.bar {
    color:white;
    padding-left:0.5em;
    padding-top: 0.5em;
    margin-top:4px;
    
}

</style>    

</head>
<body>
<button id="btn">append</button>    
<div id="stage"></div>


<script src="//unpkg.com/d3@5.0.0/dist/d3.min.js"></script>    
<script>
/*
    エレメントにデータをバインディングし、バインディングしたデータを元に属性値をアップデートするサンプルです。
    データの個数に応じて、必要な数のエレメントがappendされます。
 */
var data = [
    {id:1, value:320},
    {id:2, value:210},
    {id:3, value:410},
    {id:4, value:790},
    {id:5, value:550},
    {id:6, value:390}
]

var data2 = [
    {id:1, value:390},
    {id:2, value:110},
    {id:3, value:310},
    {id:4, value:490},
    {id:5, value:850},
    {id:6, value:590}
]
    
d3.select("#btn").on("click", render(data))    



function render(data){
    
    var stage = d3.select("#stage");
    
    
     enterDIV = stage.selectAll(".bar") //クラス名barの要素を選択する
        .data(data) //データをエレメントにバインド
        .enter() //データの個数と現状のエレメントの数を比較し、必要な数だけエレメントを追加する
        .append("div") //enterメソッドで検出された足りていないエレメントの分だけdiv要素を追加する
        .attr("class", "bar") //新たに追加したdibエレメントにクラス名をbarを指定する
        
    
    //追加したdiv要素のスタイルを設定
    enterDIV
        .style("width", "0px")
        .style("height", "50px")
        .style("background-color", function (val, i) {
            console.log(val.value)
            if(val.value >= 500) {
                return 'red'
            }else{
                return 'blue'
            }
        })             
        .transition()
        .duration(1000)
        .style("width", function(d){ return d.value + "px"}) //ここではデータのvalue値をそのままwidthのサイズに適用する
        .style("height", "50px")
        .text(function(d){ return "id:" + d.id + " value:" + d.value}) //エレメントの中にテキストを配置する(innerText)
        
    

}
    
</script>

</body>
</html>